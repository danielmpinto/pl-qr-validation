<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PL QR Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body style="text-align:center; font-family: sans-serif;">

    <div id="div-setup">
        <h3>Settings</h3>
        <p>Seed:</p>
        <input type="password" id="id-seed">
        <br><br>
        <button onclick="save()">Save</button>
    </div>

    <div id="div-app" style="display:none">
        <br>
        <button onclick="generates()">QR Code GEN</button>
        <br><br>
        <div id="qrcode" style="display: flex; justify-content: center;"></div>        
        <br><br><br>
        <button onclick="reset()" style="font-size: 0.8em;">Trocar Frase Secreta</button>
    </div>

    <script>
        const seedArmazenada = localStorage.getItem("SEED");
        if (seedArmazenada) {
            document.getElementById("div-setup").style.display = "none";
            document.getElementById("div-app").style.display = "block";
        }

        function save() {
            const val = document.getElementById("id-seed").value;
            if (val) { localStorage.setItem("SEED", val.trim()); location.reload(); }
        }

        function reset() {
            if(confirm("Reset SEED?")) { localStorage.clear(); location.reload(); }
        }

        function generates() {
            document.getElementById("qrcode").innerHTML = "";
            const seed = localStorage.getItem("SEED");
            const key = CryptoJS.SHA256(seed);
            const ts = Math.floor(Date.now() / 1000).toString();
            const payload = ts;
            const encrypted = CryptoJS.AES.encrypt(payload, key, {
                mode: CryptoJS.mode.ECB,
                padding: CryptoJS.pad.Pkcs7
            }).toString();

            new QRCode(document.getElementById("qrcode"), {
                text: encrypted,
                width: 256,
                height: 256
            });
        }
    </script>
</body>
</html>